#!/usr/bin/env bash
# OpenBB company profile tool - sector, industry, description, etc.
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")" && pwd)"
# shellcheck source=/dev/null
source "$SCRIPT_DIR/_openbb_common.sh"


if [ $# -lt 1 ]; then
    echo "Usage: openbb-profile SYMBOL [provider]"
    exit 1
fi

SYMBOL="$1"
PROVIDER="$(resolve_openbb_provider "${2:-}")"

run_openbb_python_with_retry << PYTHON
from openbb import obb
import json

symbol = "$SYMBOL"

try:
    # Get company profile
    result = obb.equity.profile(symbol=symbol, provider='$PROVIDER')
    
    if not result.results:
        print(json.dumps({"error": "No profile data found"}))
        exit(1)
    
    data = result.results[0]
    
    # Extract profile information
    output = {
        "symbol": symbol,
        "name": getattr(data, 'name', None),
        "sector": getattr(data, 'sector', None),
        "industry": getattr(data, 'industry', None),
        "country": getattr(data, 'country', None),
        "website": getattr(data, 'website', None),
        "description": getattr(data, 'description', None),
        "ceo": getattr(data, 'ceo', None),
        "employees": getattr(data, 'employees', None),
        "address": getattr(data, 'address', None),
        "city": getattr(data, 'city', None),
        "state": getattr(data, 'state', None),
        "zip": getattr(data, 'zip', None),
        "phone": getattr(data, 'phone', None)
    }
    
    print(json.dumps(output, indent=2))
    
except Exception as e:
    print(json.dumps({"error": str(e)}))
    exit(1)
PYTHON
